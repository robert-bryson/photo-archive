#!/bin/bash
# Script Name: parc
# Description: Photo ARChive -- archive photos from input to archive destination.
# Author: rsmb

# Exit immediately if a command exits with a non-zero status
set -e

# Uncomment to enable debugging
set -x

# Variables
SCRIPT_NAME=$(basename "$0")
LOG_FILE="/var/log/${SCRIPT_NAME%.sh}.log"
DEBUG=false
INPUT_DIR=""
OUTPUT_DIR=""

# Functions

# Log messages to console and file
log() {
  local MESSAGE=$1
  echo "$(date +"%Y-%m-%d %H:%M:%S") : $MESSAGE" | tee -a "$LOG_FILE"
}

# Print usage information
usage() {
  cat <<EOF
Usage: $SCRIPT_NAME -i <input_directory> -o <output_directory> [options]

Options:
  -i, --input      Specify the input directory (required)
  -o, --output     Specify the output directory (required)
  -h, --help       Display this help message
  -d, --debug      Enable debug mode
  -v, --version    Display the script version
EOF
}

# Main functionality of the script
main() {
  log "Starting script execution..."
  log "Input Directory: $INPUT_DIR"
  log "Output Directory: $OUTPUT_DIR"

  # Add main processing logic here
  if [[ ! -d "$INPUT_DIR" ]]; then
    log "Error: Input directory '$INPUT_DIR' does not exist."
    exit 1
  fi

  if [[ ! -d "$OUTPUT_DIR" ]]; then
    log "Error: Output directory '$OUTPUT_DIR' does not exist."
    exit 1
  fi

  log "Processing files from $INPUT_DIR to $OUTPUT_DIR..."
  # Example processing logic (copy files as a placeholder)
  cp -r "$INPUT_DIR"/* "$OUTPUT_DIR"/

  log "Script completed successfully."
}

# Parse command-line arguments
while [[ $# -gt 0 ]]; do
  case $1 in
  -i | --input)
    INPUT_DIR=$2
    shift 2
    ;;
  -o | --output)
    OUTPUT_DIR=$2
    shift 2
    ;;
  -h | --help)
    usage
    exit 0
    ;;
  -d | --debug)
    DEBUG=true
    set -x
    shift
    ;;
  -v | --version)
    echo "$SCRIPT_NAME version 1.0"
    exit 0
    ;;
  *)
    echo "Unknown option: $1"
    usage
    exit 1
    ;;
  esac
done

# Validate required parameters
if [[ -z "$INPUT_DIR" || -z "$OUTPUT_DIR" ]]; then
  echo "Error: Both input and output directories are required."
  usage
  exit 1
fi

# Call the main function
main
